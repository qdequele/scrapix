---
title: 'Fly.io Deployment'
description: 'Deploy Scrapix globally with Fly.io'
icon: 'plane'
---

## Overview

Deploy Scrapix on Fly.io for global distribution, automatic scaling, and built-in SSL. This guide covers deployment with Redis (Upstash) for job queuing.

## Prerequisites

<Info>
  **Before you begin:**
  - Install the [Fly CLI](https://fly.io/docs/hands-on/install-flyctl/)
  - Create a [Fly.io account](https://fly.io/signup)
  - Have your Meilisearch instance ready (cloud or self-hosted)
</Info>

## Quick Deploy

<Steps>
  <Step title="Login to Fly.io">
    ```bash
    fly auth login
    ```
  </Step>
  
  <Step title="Launch the app">
    ```bash
    # From the project root
    fly launch --no-deploy
    
    # This creates:
    # - fly.toml configuration
    # - Fly.io app instance
    ```
  </Step>
  
  <Step title="Set up Redis with Upstash">
    ```bash
    # Create Upstash Redis instance
    fly redis create
    
    # Note the connection URL provided
    ```
  </Step>
  
  <Step title="Configure secrets">
    ```bash
    # Set required secrets
    fly secrets set MEILISEARCH_URL="https://your-meilisearch.com" \
      MEILISEARCH_API_KEY="your-api-key" \
      REDIS_URL="redis://default:password@fly-redis.upstash.io" \
      OPENAI_API_KEY="sk-..." \
      WEBHOOK_URL="https://your-webhook.com" \
      WEBHOOK_TOKEN="your-webhook-token"
    ```
  </Step>
  
  <Step title="Deploy">
    ```bash
    fly deploy
    ```
  </Step>
  
  <Step title="Verify deployment">
    ```bash
    # Check status
    fly status
    
    # View logs
    fly logs
    
    # Open in browser
    fly open
    ```
  </Step>
</Steps>

## Configuration Files

### fly.toml

The `fly.toml` file configures your Fly.io deployment:

```toml
app = "scrapix"
primary_region = "iad"
kill_signal = "SIGINT"
kill_timeout = "5s"

[build]
  dockerfile = "Dockerfile"

[env]
  NODE_ENV = "production"
  PORT = "8080"
  PUPPETEER_SKIP_CHROMIUM_DOWNLOAD = "true"
  PUPPETEER_EXECUTABLE_PATH = "/usr/bin/google-chrome-stable"

[[services]]
  protocol = "tcp"
  internal_port = 8080
  processes = ["app"]

  [[services.ports]]
    port = 80
    handlers = ["http"]
    force_https = true

  [[services.ports]]
    port = 443
    handlers = ["tls", "http"]
  
  [services.concurrency]
    type = "connections"
    hard_limit = 25
    soft_limit = 20

  [[services.http_checks]]
    interval = "10s"
    timeout = "2s"
    grace_period = "5s"
    method = "get"
    path = "/health"

[[vm]]
  cpu_kind = "shared"
  cpus = 1
  memory_mb = 1024
```

### Multi-Region Deployment

<Tabs>
  <Tab title="Add Regions">
    ```bash
    # Add regions for global coverage
    fly regions add lhr  # London
    fly regions add nrt  # Tokyo
    fly regions add syd  # Sydney
    
    # View current regions
    fly regions list
    ```
  </Tab>
  
  <Tab title="Scale Instances">
    ```bash
    # Scale horizontally
    fly scale count 3
    
    # Scale vertically
    fly scale vm shared-cpu-2x --memory 2048
    
    # View current scale
    fly scale show
    ```
  </Tab>
</Tabs>

## Environment Variables

Configure these environment variables:

```bash
# Required
fly secrets set \
  MEILISEARCH_URL="https://ms-xxx.meilisearch.io" \
  MEILISEARCH_API_KEY="your-master-key" \
  REDIS_URL="redis://default:xxx@fly-xxx.upstash.io"

# Optional
fly secrets set \
  OPENAI_API_KEY="sk-..." \
  MAX_CONCURRENCY="10" \
  BATCH_SIZE="100" \
  WEBHOOK_URL="https://your-webhook.com" \
  WEBHOOK_TOKEN="secret-token"

# View all secrets
fly secrets list
```

## Database Setup

### Using Upstash Redis

<Accordion title="Upstash Redis Setup">
1. **Create Redis instance:**
```bash
fly redis create
# Choose a name: scrapix-redis
# Choose a region: same as your app
# Choose plan: Free or Pay-as-you-go
```

2. **Get connection details:**
```bash
fly redis status scrapix-redis
```

3. **Attach to your app:**
```bash
fly redis attach scrapix-redis
```

This automatically sets the `REDIS_URL` secret.
</Accordion>

### Using Fly Postgres (Alternative)

<Accordion title="PostgreSQL with BullMQ">
```bash
# Create Postgres cluster
fly postgres create --name scrapix-db

# Attach to app
fly postgres attach scrapix-db

# This sets DATABASE_URL automatically
```

Note: Requires additional configuration for BullMQ to use PostgreSQL.
</Accordion>

## Monitoring

### View Logs

```bash
# Live logs
fly logs --tail

# Filter by level
fly logs --level error

# Export logs
fly logs > scrapix.log
```

### Metrics Dashboard

```bash
# Open metrics dashboard
fly dashboard metrics

# Or view in terminal
fly status --all
```

### SSH into Container

```bash
# Connect via SSH
fly ssh console

# Debug inside container
$ node --version
$ curl http://localhost:8080/health
$ ps aux | grep node
```

## Custom Domain

<Steps>
  <Step title="Add custom domain">
    ```bash
    fly certs add scrapix.yourdomain.com
    ```
  </Step>
  
  <Step title="Configure DNS">
    Add these DNS records:
    - **A Record**: `@` â†’ Your Fly IPv4
    - **AAAA Record**: `@` â†’ Your Fly IPv6
    
    Get IPs:
    ```bash
    fly ips list
    ```
  </Step>
  
  <Step title="Verify certificate">
    ```bash
    fly certs show scrapix.yourdomain.com
    ```
  </Step>
</Steps>

## Deployment Script

Create a deployment script for CI/CD:

```bash
#!/bin/bash
# deploy.sh

set -e

echo "ðŸš€ Deploying Scrapix to Fly.io..."

# Set Fly API token (from CI secrets)
export FLY_API_TOKEN=$FLY_API_TOKEN

# Deploy
fly deploy --remote-only

# Check deployment
fly status

# Run health check
curl -f https://scrapix.fly.dev/health || exit 1

echo "âœ… Deployment successful!"
```

## GitHub Actions Integration

```yaml
name: Deploy to Fly.io

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - uses: superfly/flyctl-actions/setup-flyctl@master
      
      - run: flyctl deploy --remote-only
        env:
          FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
```

## Troubleshooting

<AccordionGroup>
  <Accordion title="App won't start">
    **Check logs:**
    ```bash
    fly logs --tail
    ```
    
    **Common issues:**
    - Missing environment variables
    - Port mismatch (should be 8080)
    - Memory limits too low
    
    **Fix:**
    ```bash
    fly scale memory 2048
    fly secrets set PORT=8080
    ```
  </Accordion>
  
  <Accordion title="Puppeteer crashes">
    **Error:** Chrome won't launch
    
    **Solution:**
    ```bash
    # Use optimized Dockerfile
    fly deploy --dockerfile Dockerfile.fly
    
    # Or increase memory
    fly scale memory 2048
    ```
  </Accordion>
  
  <Accordion title="Redis connection issues">
    **Verify Redis URL:**
    ```bash
    fly secrets list
    fly redis status
    ```
    
    **Test connection:**
    ```bash
    fly ssh console
    $ npm install redis-cli -g
    $ redis-cli -u $REDIS_URL ping
    ```
  </Accordion>
</AccordionGroup>

## Performance Optimization

<Info>
  **Best Practices for Fly.io:**
  
  1. **Use multi-region deployment** for global latency
  2. **Enable auto-scaling** for traffic spikes
  3. **Configure health checks** properly
  4. **Use Fly's built-in caching** where possible
  5. **Monitor memory usage** and scale accordingly
</Info>

## Cost Optimization

<Table>
  <thead>
    <tr>
      <th>Resource</th>
      <th>Free Tier</th>
      <th>Recommendation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>VMs</td>
      <td>3 shared-cpu-1x</td>
      <td>Start with 1, scale as needed</td>
    </tr>
    <tr>
      <td>Memory</td>
      <td>256MB per VM</td>
      <td>Use 1GB for Puppeteer</td>
    </tr>
    <tr>
      <td>Bandwidth</td>
      <td>100GB/month</td>
      <td>Monitor with `fly dashboard`</td>
    </tr>
    <tr>
      <td>Persistent Storage</td>
      <td>3GB total</td>
      <td>Use external storage for large data</td>
    </tr>
  </tbody>
</Table>

## Next Steps

<CardGroup cols={2}>
  <Card
    title="Docker Deployment"
    icon="docker"
    href="/deployment/docker"
  >
    Alternative deployment with Docker
  </Card>
  <Card
    title="Configuration Reference"
    icon="gear"
    href="/References/config-reference"
  >
    Full configuration options
  </Card>
</CardGroup>